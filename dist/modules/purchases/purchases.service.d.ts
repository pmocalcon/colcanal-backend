import { Repository, DataSource } from 'typeorm';
import { Requisition } from '../../database/entities/requisition.entity';
import { RequisitionItem } from '../../database/entities/requisition-item.entity';
import { RequisitionLog } from '../../database/entities/requisition-log.entity';
import { RequisitionStatus } from '../../database/entities/requisition-status.entity';
import { RequisitionPrefix } from '../../database/entities/requisition-prefix.entity';
import { RequisitionSequence } from '../../database/entities/requisition-sequence.entity';
import { RequisitionItemApproval } from '../../database/entities/requisition-item-approval.entity';
import { OperationCenter } from '../../database/entities/operation-center.entity';
import { ProjectCode } from '../../database/entities/project-code.entity';
import { User } from '../../database/entities/user.entity';
import { Authorization } from '../../database/entities/authorization.entity';
import { Company } from '../../database/entities/company.entity';
import { CreateRequisitionDto } from './dto/create-requisition.dto';
import { UpdateRequisitionDto } from './dto/update-requisition.dto';
import { FilterRequisitionsDto } from './dto/filter-requisitions.dto';
import { ReviewRequisitionDto } from './dto/review-requisition.dto';
import { Supplier } from '../../database/entities/supplier.entity';
import { RequisitionItemQuotation } from '../../database/entities/requisition-item-quotation.entity';
import { ManageQuotationDto } from './dto/manage-quotation.dto';
import { PurchaseOrder } from '../../database/entities/purchase-order.entity';
import { PurchaseOrderItem } from '../../database/entities/purchase-order-item.entity';
import { PurchaseOrderSequence } from '../../database/entities/purchase-order-sequence.entity';
import { PurchaseOrderStatus } from '../../database/entities/purchase-order-status.entity';
import { MaterialReceipt } from '../../database/entities/material-receipt.entity';
import { MaterialPriceHistory } from '../../database/entities/material-price-history.entity';
import { PurchaseOrderApproval } from '../../database/entities/purchase-order-approval.entity';
import { PurchaseOrderItemApproval } from '../../database/entities/purchase-order-item-approval.entity';
import { CreatePurchaseOrdersDto } from './dto/create-purchase-orders.dto';
import { CreateMaterialReceiptDto } from './dto/create-material-receipt.dto';
import { UpdateMaterialReceiptDto } from './dto/update-material-receipt.dto';
import { ApprovePurchaseOrderDto } from './dto/approve-purchase-order.dto';
export declare class PurchasesService {
    private requisitionRepository;
    private requisitionItemRepository;
    private requisitionLogRepository;
    private requisitionStatusRepository;
    private requisitionPrefixRepository;
    private requisitionSequenceRepository;
    private operationCenterRepository;
    private projectCodeRepository;
    private userRepository;
    private authorizationRepository;
    private companyRepository;
    private supplierRepository;
    private quotationRepository;
    private purchaseOrderRepository;
    private purchaseOrderItemRepository;
    private purchaseOrderSequenceRepository;
    private materialReceiptRepository;
    private itemApprovalRepository;
    private materialPriceHistoryRepository;
    private purchaseOrderApprovalRepository;
    private purchaseOrderItemApprovalRepository;
    private purchaseOrderStatusRepository;
    private dataSource;
    constructor(requisitionRepository: Repository<Requisition>, requisitionItemRepository: Repository<RequisitionItem>, requisitionLogRepository: Repository<RequisitionLog>, requisitionStatusRepository: Repository<RequisitionStatus>, requisitionPrefixRepository: Repository<RequisitionPrefix>, requisitionSequenceRepository: Repository<RequisitionSequence>, operationCenterRepository: Repository<OperationCenter>, projectCodeRepository: Repository<ProjectCode>, userRepository: Repository<User>, authorizationRepository: Repository<Authorization>, companyRepository: Repository<Company>, supplierRepository: Repository<Supplier>, quotationRepository: Repository<RequisitionItemQuotation>, purchaseOrderRepository: Repository<PurchaseOrder>, purchaseOrderItemRepository: Repository<PurchaseOrderItem>, purchaseOrderSequenceRepository: Repository<PurchaseOrderSequence>, materialReceiptRepository: Repository<MaterialReceipt>, itemApprovalRepository: Repository<RequisitionItemApproval>, materialPriceHistoryRepository: Repository<MaterialPriceHistory>, purchaseOrderApprovalRepository: Repository<PurchaseOrderApproval>, purchaseOrderItemApprovalRepository: Repository<PurchaseOrderItemApproval>, purchaseOrderStatusRepository: Repository<PurchaseOrderStatus>, dataSource: DataSource);
    private getStatusIdByCode;
    private getPurchaseOrderStatusId;
    private saveItemApprovals;
    getItemApprovals(requisitionId: number, approvalLevel?: 'reviewer' | 'management'): Promise<any[]>;
    private invalidateItemApprovals;
    private invalidateItemApprovalsByContent;
    createRequisition(userId: number, dto: CreateRequisitionDto): Promise<Requisition>;
    getMyRequisitions(userId: number, filters: FilterRequisitionsDto): Promise<{
        data: Requisition[];
        total: number;
        page: number;
        limit: number;
        totalPages: number;
    }>;
    getRequisitionById(requisitionId: number, userId: number): Promise<Requisition>;
    updateRequisition(requisitionId: number, userId: number, dto: UpdateRequisitionDto): Promise<Requisition>;
    deleteRequisition(requisitionId: number, userId: number): Promise<{
        message: string;
    }>;
    getPendingActions(userId: number, filters: FilterRequisitionsDto): Promise<{
        data: never[];
        total: number;
        page: number;
        limit: number;
        totalPages: number;
        pending: never[];
        processed: never[];
    } | {
        data: any[];
        total: number;
        page: number;
        limit: number;
        totalPages: number;
        pending: number;
        processed: number;
    }>;
    reviewRequisition(requisitionId: number, userId: number, dto: ReviewRequisitionDto): Promise<Requisition>;
    approveRequisition(requisitionId: number, userId: number, dto: {
        comments?: string;
        itemDecisions?: Array<{
            itemId: number;
            decision: 'approve' | 'reject';
            comments?: string;
        }>;
    }): Promise<Requisition>;
    rejectRequisitionByManager(requisitionId: number, userId: number, dto: {
        comments: string;
    }): Promise<Requisition>;
    private generateRequisitionNumber;
    private determineOperationCenter;
    private determineProjectCode;
    private validateUserCanCreate;
    private isAuthorizer;
    private canViewRequisition;
    getRequisitionsForQuotation(userId: number, filters: FilterRequisitionsDto): Promise<{
        data: {
            slaDeadline: Date | null;
            isOverdue: boolean;
            daysOverdue: number;
            requisitionId: number;
            requisitionNumber: string;
            companyId: number;
            projectId: number;
            operationCenterId: number;
            projectCodeId: number;
            createdBy: number;
            statusId: number;
            reviewedBy: number;
            approvedBy: number;
            createdAt: Date;
            updatedAt: Date;
            reviewedAt: Date;
            approvedAt: Date;
            obra: string;
            codigoObra: string;
            company: Company;
            project: import("../../database/entities").Project;
            operationCenter: OperationCenter;
            projectCode: ProjectCode;
            creator: User;
            status: RequisitionStatus;
            reviewer: User;
            approver: User;
            items: RequisitionItem[];
            logs: RequisitionLog[];
            purchaseOrders: PurchaseOrder[];
            approvals: import("../../database/entities").RequisitionApproval[];
        }[];
        total: number;
        page: number;
        limit: number;
        totalPages: number;
    }>;
    getRequisitionQuotation(requisitionId: number, userId: number): Promise<{
        items: {
            quotations: RequisitionItemQuotation[];
            itemId: number;
            requisitionId: number;
            itemNumber: number;
            materialId: number;
            quantity: number;
            observation: string;
            requisition: Requisition;
            material: import("../../database/entities").Material;
            purchaseOrderItems: PurchaseOrderItem[];
        }[];
        requisitionId: number;
        requisitionNumber: string;
        companyId: number;
        projectId: number;
        operationCenterId: number;
        projectCodeId: number;
        createdBy: number;
        statusId: number;
        reviewedBy: number;
        approvedBy: number;
        createdAt: Date;
        updatedAt: Date;
        reviewedAt: Date;
        approvedAt: Date;
        obra: string;
        codigoObra: string;
        company: Company;
        project: import("../../database/entities").Project;
        operationCenter: OperationCenter;
        projectCode: ProjectCode;
        creator: User;
        status: RequisitionStatus;
        reviewer: User;
        approver: User;
        logs: RequisitionLog[];
        purchaseOrders: PurchaseOrder[];
        approvals: import("../../database/entities").RequisitionApproval[];
    }>;
    manageQuotation(requisitionId: number, userId: number, dto: ManageQuotationDto): Promise<{
        items: {
            quotations: RequisitionItemQuotation[];
            itemId: number;
            requisitionId: number;
            itemNumber: number;
            materialId: number;
            quantity: number;
            observation: string;
            requisition: Requisition;
            material: import("../../database/entities").Material;
            purchaseOrderItems: PurchaseOrderItem[];
        }[];
        requisitionId: number;
        requisitionNumber: string;
        companyId: number;
        projectId: number;
        operationCenterId: number;
        projectCodeId: number;
        createdBy: number;
        statusId: number;
        reviewedBy: number;
        approvedBy: number;
        createdAt: Date;
        updatedAt: Date;
        reviewedAt: Date;
        approvedAt: Date;
        obra: string;
        codigoObra: string;
        company: Company;
        project: import("../../database/entities").Project;
        operationCenter: OperationCenter;
        projectCode: ProjectCode;
        creator: User;
        status: RequisitionStatus;
        reviewer: User;
        approver: User;
        logs: RequisitionLog[];
        purchaseOrders: PurchaseOrder[];
        approvals: import("../../database/entities").RequisitionApproval[];
    }>;
    assignPrices(requisitionId: number, userId: number, dto: any): Promise<{
        items: {
            quotations: RequisitionItemQuotation[];
            itemId: number;
            requisitionId: number;
            itemNumber: number;
            materialId: number;
            quantity: number;
            observation: string;
            requisition: Requisition;
            material: import("../../database/entities").Material;
            purchaseOrderItems: PurchaseOrderItem[];
        }[];
        requisitionId: number;
        requisitionNumber: string;
        companyId: number;
        projectId: number;
        operationCenterId: number;
        projectCodeId: number;
        createdBy: number;
        statusId: number;
        reviewedBy: number;
        approvedBy: number;
        createdAt: Date;
        updatedAt: Date;
        reviewedAt: Date;
        approvedAt: Date;
        obra: string;
        codigoObra: string;
        company: Company;
        project: import("../../database/entities").Project;
        operationCenter: OperationCenter;
        projectCode: ProjectCode;
        creator: User;
        status: RequisitionStatus;
        reviewer: User;
        approver: User;
        logs: RequisitionLog[];
        purchaseOrders: PurchaseOrder[];
        approvals: import("../../database/entities").RequisitionApproval[];
    }>;
    createPurchaseOrders(requisitionId: number, userId: number, dto: CreatePurchaseOrdersDto): Promise<{
        requisitionId: number;
        previousStatus: string;
        newStatus: string;
        purchaseOrders: PurchaseOrder[];
    }>;
    getLatestMaterialPrice(materialId: number, supplierId: number): Promise<{
        materialId: number;
        supplierId: number;
        unitPrice: number;
        hasIva: boolean;
        ivaPercentage: number;
        discount: number;
        lastUsedDate: Date;
        purchaseOrderNumber: string;
        supplierName: string;
    } | null>;
    getMyPendingReceipts(userId: number, filters: FilterRequisitionsDto): Promise<{
        data: any[];
        total: number;
        page: number;
        limit: number;
        totalPages: number;
    }>;
    getRequisitionReceipts(requisitionId: number, userId: number): Promise<{
        purchaseOrders: any;
        requisitionId: number;
        requisitionNumber: string;
        companyId: number;
        projectId: number;
        operationCenterId: number;
        projectCodeId: number;
        createdBy: number;
        statusId: number;
        reviewedBy: number;
        approvedBy: number;
        createdAt: Date;
        updatedAt: Date;
        reviewedAt: Date;
        approvedAt: Date;
        obra: string;
        codigoObra: string;
        company: Company;
        project: import("../../database/entities").Project;
        operationCenter: OperationCenter;
        projectCode: ProjectCode;
        creator: User;
        status: RequisitionStatus;
        reviewer: User;
        approver: User;
        items: RequisitionItem[];
        logs: RequisitionLog[];
        approvals: import("../../database/entities").RequisitionApproval[];
    }>;
    createMaterialReceipts(requisitionId: number, userId: number, dto: CreateMaterialReceiptDto): Promise<{
        purchaseOrders: any;
        requisitionId: number;
        requisitionNumber: string;
        companyId: number;
        projectId: number;
        operationCenterId: number;
        projectCodeId: number;
        createdBy: number;
        statusId: number;
        reviewedBy: number;
        approvedBy: number;
        createdAt: Date;
        updatedAt: Date;
        reviewedAt: Date;
        approvedAt: Date;
        obra: string;
        codigoObra: string;
        company: Company;
        project: import("../../database/entities").Project;
        operationCenter: OperationCenter;
        projectCode: ProjectCode;
        creator: User;
        status: RequisitionStatus;
        reviewer: User;
        approver: User;
        items: RequisitionItem[];
        logs: RequisitionLog[];
        approvals: import("../../database/entities").RequisitionApproval[];
    }>;
    updateMaterialReceipt(requisitionId: number, receiptId: number, userId: number, dto: UpdateMaterialReceiptDto): Promise<MaterialReceipt | null>;
    getPurchaseOrders(userId: number, page?: number, limit?: number, filters?: {
        requisitionId?: number;
        supplierId?: number;
        fromDate?: string;
        toDate?: string;
    }): Promise<{
        data: PurchaseOrder[];
        total: number;
        page: number;
        totalPages: number;
    }>;
    getPurchaseOrderById(purchaseOrderId: number): Promise<PurchaseOrder>;
    getPurchaseOrdersByRequisition(requisitionId: number, userId: number): Promise<{
        requisition: {
            requisitionId: number;
            requisitionNumber: string;
            status: RequisitionStatus;
        };
        purchaseOrders: PurchaseOrder[];
    }>;
    getPendingPurchaseOrdersForApproval(userId: number, page?: number, limit?: number): Promise<{
        data: {
            deadline: Date;
            isOverdue: boolean;
            daysOverdue: number;
            purchaseOrderId: number;
            purchaseOrderNumber: string;
            requisitionId: number;
            supplierId: number;
            issueDate: Date;
            subtotal: number;
            totalIva: number;
            totalDiscount: number;
            totalAmount: number;
            approvalStatusId: number;
            rejectionCount: number;
            lastRejectionReason: string | null;
            currentApproverId: number;
            createdBy: number;
            totalInvoicedAmount: number;
            totalInvoicedQuantity: number;
            invoiceStatus: string;
            createdAt: Date;
            updatedAt: Date;
            requisition: Requisition;
            supplier: Supplier;
            creator: User;
            currentApprover: User;
            approvalStatus: PurchaseOrderStatus;
            items: PurchaseOrderItem[];
            approvals: PurchaseOrderApproval[];
            invoices: import("../../database/entities").Invoice[];
        }[];
        total: number;
        page: number;
        limit: number;
        totalPages: number;
    }>;
    getPurchaseOrderForApproval(purchaseOrderId: number, userId: number): Promise<{
        deadline: Date;
        isOverdue: boolean;
        daysOverdue: number;
        purchaseOrderId: number;
        purchaseOrderNumber: string;
        requisitionId: number;
        supplierId: number;
        issueDate: Date;
        subtotal: number;
        totalIva: number;
        totalDiscount: number;
        totalAmount: number;
        approvalStatusId: number;
        rejectionCount: number;
        lastRejectionReason: string | null;
        currentApproverId: number;
        createdBy: number;
        totalInvoicedAmount: number;
        totalInvoicedQuantity: number;
        invoiceStatus: string;
        createdAt: Date;
        updatedAt: Date;
        requisition: Requisition;
        supplier: Supplier;
        creator: User;
        currentApprover: User;
        approvalStatus: PurchaseOrderStatus;
        items: PurchaseOrderItem[];
        approvals: PurchaseOrderApproval[];
        invoices: import("../../database/entities").Invoice[];
    }>;
    approvePurchaseOrder(purchaseOrderId: number, userId: number, dto: ApprovePurchaseOrderDto): Promise<PurchaseOrder>;
    rejectPurchaseOrder(purchaseOrderId: number, userId: number, rejectionReason: string): Promise<PurchaseOrder>;
    resubmitPurchaseOrder(purchaseOrderId: number, userId: number, comments?: string): Promise<PurchaseOrder>;
}
